# Hospital Wizards Documentation

## Огляд візардів модуля HR Hospital

Модуль містить 5 візардів для автоматизації різних процесів у лікарні.

## 1. Mass Reassign Doctor Wizard (Масове перепризначення лікаря)

**Модель:** `mass.reassign.doctor.wizard`

**Призначення:** Дозволяє масово перепризначити пацієнтів зі старого лікаря на нового.

### Як викликати:

1. **З меню "Дія" у list view пацієнтів:**
   - Перейдіть до: `Caritas Ukraine → Patients`
   - Виберіть пацієнтів у списку (відмітьте чекбокси)
   - Натисніть кнопку "Дія" (Action) у верхній частині списку
   - Виберіть "Mass Reassign Doctor"

### Функціонал:
- Вибір старого лікаря (автоматично показує його пацієнтів)
- Вибір нового лікаря
- Вибір пацієнтів для перепризначення
- Вказівка дати зміни
- Обов'язкове введення причини зміни
- Автоматичне створення записів історії змін лікарів

### Валідації:
- Старий та новий лікар повинні бути різними
- Потрібно вибрати хоча б одного пацієнта

## 2. Disease Report Wizard (Звіт по хворобах за період)

**Модель:** `disease.report.wizard`

**Призначення:** Генерує звіти по діагнозах та хворобах за вказаний період з можливістю фільтрації та групування.

### Як викликати:

1. **З головного меню:**
   - Перейдіть до: `Caritas Ukraine → Reports → Disease Report`

### Функціонал:
- Фільтрація за періодом (дата від/до) - обов'язково
- Фільтрація за лікарями (якщо не вказано - по всім)
- Фільтрація за хворобами (якщо не вказано - по всім)
- Фільтрація за країнами громадянства пацієнтів
- Вибір типу звіту: детальний або підсумковий
- Групування за: лікарем/хворобою/місяцем/країною
- Повертає список діагнозів у tree view

### Типи звітів:
- **Детальний:** показує всі діагнози з повною інформацією
- **Підсумковий:** показує агреговані дані за обраним групуванням

### Валідації:
- Дата початку повинна бути раніше дати закінчення
- Система перевіряє наявність діагнозів за критеріями

---

## 3. Reschedule Visit Wizard (Перенесення візиту)

**Модель:** `reschedule.visit.wizard`

**Призначення:** Дозволяє перенести візит на іншу дату/час або до іншого лікаря.

### Як викликати:

1. **З форми візиту (Form View):**
   - Відкрийте візит: `Caritas Ukraine → Visits → [виберіть візит]`
   - Натисніть кнопку "Дія" (Action) у формі
   - Виберіть "Reschedule Visit"

2. **З меню "Дія" у форм view візитів:**
   - Знаходячись у формі візиту
   - Action → Reschedule Visit

### Функціонал:
- Відображає поточну інформацію про візит (лікар, дата/час)
- Дозволяє вибрати нового лікаря (опціонально)
- Вибір нової дати (обов'язково)
- Вибір нового часу (обов'язково)
- Обов'язкове введення причини перенесення
- Перевіряє конфлікти у розкладі
- Логує зміни у чаттері візиту

### Валідації:
- Можна переносити тільки візити зі статусом "Planned"
- Нова дата не може бути у минулому
- Час повинен бути у діапазоні 0:00-23:59
- Перевіряється наявність конфліктів (інший візит у той же час)

## 4. Doctor Schedule Wizard (Заповнення розкладу лікаря)

**Модель:** `doctor.schedule.wizard`

**Призначення:** Автоматично генерує розклад роботи лікаря на кілька тижнів.

### Як викликати:

1. **З головного меню:**
   - Перейдіть до: `Caritas Ukraine → Wizards → Fill Doctor Schedule`

2. **Альтернативно, можна додати кнопку у форму лікаря**

### Функціонал:
- Вибір лікаря (обов'язково)
- Вказівка дати початку тижня
- Кількість тижнів для генерації (за замовчуванням 1)
- Тип розкладу:
  - **Стандартний:** кожен тиждень
  - **Парний тиждень:** тільки парні тижні року
  - **Непарний тиждень:** тільки непарні тижні року
- Вибір робочих днів (Пн-Нд)
- Час початку та закінчення роботи
- Час перерви (опціонально)
- Автоматичне створення двох змін (до перерви та після) якщо вказана перерва

### Валідації:
- Кількість тижнів >= 1
- Час роботи у діапазоні 0:00-23:59
- Час початку < час закінчення
- Перерва повинна бути в межах робочого часу
- Потрібно вибрати хоча б один день тижня

---

## 5. Patient Card Export Wizard (Експорт медичної картки пацієнта)

**Модель:** `patient.card.export.wizard`

**Призначення:** Експортує повну медичну картку пацієнта у форматі JSON або CSV.

### Як викликати:

1. **З форми пацієнта (Form View):**
   - Відкрийте картку пацієнта: `Caritas Ukraine → Patients → [виберіть пацієнта]`
   - Натисніть кнопку "Дія" (Action)
   - Виберіть "Export Medical Card"

### Функціонал:
- Автоматично визначає пацієнта з контексту
- Фільтрація за періодом (опціонально)
- Включення/виключення діагнозів (за замовчуванням включено)
- Включення/виключення рекомендацій (за замовчуванням включено)
- Вибір мови звіту (за замовчуванням - мова пацієнта)
- Формати експорту: JSON або CSV

### Що включає експорт:
**Основна інформація:**
- ПІБ пацієнта
- Дата народження та вік
- Стать
- Контактні дані (телефон, email)
- Громадянство
- Паспортні дані
- Група крові
- Алергії
- Особистий лікар
- Страхова компанія та номер полісу

**Історія візитів:**
- Дата та час візиту
- Лікар
- Тип візиту
- Статус
- Рекомендації (якщо включено)
- Діагнози (якщо включено):
  - Назва діагнозу
  - Хвороба
  - Опис
  - Тяжкість
  - Лікування
  - Статус підтвердження

### Формати експорту:

**JSON:**
- Структурований формат
- Зручний для інтеграції з іншими системами
- Зберігає всю ієрархію даних

**CSV:**
- Табличний формат
- Зручний для перегляду у Excel/LibreOffice
- Окремі секції для інформації та візитів

### Валідації:
- Дата початку повинна бути раніше дати закінчення
- Потрібно вибрати пацієнта

---

## Загальні особливості візардів

### Безпека:
- Всі візарди доступні для групи `base.group_user` (внутрішні користувачі)
- Візарди є TransientModel - дані автоматично видаляються після виконання

### UX/UI:
- Всі візарди відкриваються у модальному вікні (`target='new'`)
- Інтуїтивно зрозумілий інтерфейс
- Повідомлення про успішне виконання
- Детальні повідомлення про помилки

### Інтеграція:
- Візарди інтегровані у відповідні моделі через `binding_model_id`
- Автоматична передача контексту (active_id, active_model)
- Підтримка множинного вибору записів де потрібно

---

## Технічні деталі

### Файли:
- **Models:** `/custom_addons/hr_hospital/wizard/`
- **Views:** `/custom_addons/hr_hospital/views/hr_hospital_wizard_views.xml`
- **Menu:** `/custom_addons/hr_hospital/views/hr_hospital_menu.xml`
- **Security:** `/custom_addons/hr_hospital/security/ir.model.access.csv`

### Залежності:
- Модуль `base`
- Стандартні Python бібліотеки: `json`, `csv`, `io`, `base64`, `datetime`
